@model TextQuest.Models.SceneListModel

<div class="sceneObjectsContainer">
    @foreach (var obj in Model.CurrentScene.SceneObjects)
    {
        string x = obj.x + "px";
        string y = obj.y + "px";
        string id = obj.Id.ToString();
        <div id=@id class="sceneObject" style="position:absolute;left:@x;top:@y;">
            <a title=@obj.Name><img src="@obj.ImageUrl" onclick="scObjHandler(@obj.Id,@Model.CurrentScene.Id,@Model.Inventory.Id)" /></a>
        </div>
    }
</div>
<h3>Инвентарь @ViewBag.SelectedInventoryObject</h3>
<div class="inventory" style="display:flex;align-content:flex-start">
    @foreach (var item in Model.InventoryItems)
    {
        <div id=@item.Id class="inventoryObject">
            <a title=@item.Name><img src="@item.ImageUrl" onclick="invObjHandler(@item.Id)" /></a>
        </div>
    }
</div>

<script>
    function scObjHandler(data_id,scene_id,inventory_id) {
        console.log(data_id);
        console.log(scene_id);
        console.log(inventory_id);
        let selectedinventoryId;
        if ($(".inventoryObject").hasClass("selectedInventoryObject")) {
            selectedinventoryId = $(".selectedInventoryObject").attr("id");
        }
        console.log(selectedinventoryId);


        $.ajax({
                url: "/GamePage/HandleSceneObjectClick",
                type: "post",
                data: {
                    item: String(data_id),
                    scene: String(scene_id),
                    inventory: String(inventory_id),
                    selectedinventoryId:String(selectedinventoryId)
                },
                success: function (data) {
                    console.log(data);
                    if (data.interactionType == 0) {
                         $(".inventory")
                             .append($("<div>").attr("id", String(data.responce.newId)).addClass("inventoryObject")
                                    .append($("<a>")
                                        .append($("<img>").attr("src", data.responce.imageUrl)).attr("onclick", String("invObjHandler(" + data.responce.newId + ")"))));
                         $("#" + data.responce.oldId).remove();
                    }
                    else if (data.interactionType == 1) {
                        window.location.replace("@Url.RouteUrl(new { controller = "GamePage", action = "Index", id = Model.CurrentScene.InnerSceneId })");
                    }
                    else if (data.interactionType == 2) {
                        if (data.responces.length > 0) {
                            if (data.responces[0].isValid) {
                                console.log("No");
                                return;
                            }
                            for (i = 0; i < data.responces.length; i++) {
                                $("#" + data.responces[i].oldId)
                                    .replaceWith($("<div>").attr("id", String(data.responces[i].newId)).addClass("sceneObject").css("position", "absolute").css("left", data.responces[i].x).css("top", data.responces[i].y)
                                        .append($("<a>").attr("title", data.responces[i].Name) //todo: не ставится hover text
                                            .append($("<img>").attr("src", data.responces[i].imageUrl).attr("onclick", String("scObjHandler(" + data.responces[i].newId + ",@Model.CurrentScene.Id,@Model.Inventory.Id)")))));
                            }
                            $("div.selectedInventoryObject").remove()
                        }
                        
                    }
                },
                error: function () {
                    alert("error");
            }
            });
    }
</script>

<script>
    function invObjHandler(id) {

        $(".inventoryObject").removeClass("selectedInventoryObject");
        $("#" + id + ".inventoryObject").addClass("selectedInventoryObject");
        /*$.ajax({
                    url: "/GamePage/HandleInventoryObjectClick",
                    type: "post",
                    data: {
                        item: String(id),
                    },
                    success: function (data) {

                    },
                    error: function () {
                        alert("error");
                }
                });*/
    }
</script>







